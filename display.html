<!DOCTYPE html>
<html>
    <head>
        <title>Robot Wars Display</title>
        <link rel="stylesheet" href="css/display.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
        <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
        <script src="node_modules/socket.io/client-dist/socket.io.js"></script>
        <script src="js/adapter.js"></script>
    </head>
    <body>
        <h1>Robot Wars</h1>
        <div class='display-wrapper'>
            <div class='row'>
                <div class='column blue border'>
                    <span>Front End Loader</span>
                    <video id='FELA' width="100%" height="100%"></video>
                </div>
                <div class='column blue border'>
                    <span>Dump Truck</span>
                    <video id='DMPA' width="100%" height="100%"></video>
                </div>
                <div class='column blue border'>
                    <span>Excavator</span>
                    <video id='EXCA' width="100%" height="100%"></video>
                </div>
            </div>
            <div class='row'>
                <div class='column red border'>
                    <span>Front End Loader</span>
                    <video id='FELB' width="100%" height="100%"></video>
                </div>
                <div class='column red border'>
                    <span>Dump Truck</span>
                    <video id='DMPB' width="100%" height="100%"></video>
                </div>
                <div class='column red border'>
                    <span>Excavator</span>
                    <video id='EXCB' width="100%" height="100%"></video>
                </div>
            </div>
        </div>

        <script>

        var server = window.location.protocol + '//' + window.location.host;
        var socket = io(server);

        socket.on('connect', () => {

            var peer = new Peer();

            peer.on('open', function(id) {
              console.log('My peer ID is: ' + id);
              socket.emit('peer-server-id-update', id);
            });

            var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

            peer.on('call', function(call) {
              getUserMedia({video: true, audio: false}, function(stream) {
                call.answer(stream); // Answer the call with an A/V stream.
                call.on('stream', function(remoteStream) {
                    // console.log(call.metadata);
                    var video = document.getElementById(call.metadata.vehicle);
                    video.srcObject = remoteStream;
                    video.onloadedmetadata = function(e) {
                      video.play();
                    };
                });
              }, function(err) {
                console.log('Failed to get local stream' ,err);
              });
            });
        });

      </script>
  </body>
</html>
